# Status ($4015)

ステータスレジスターは、各チャンネルの有効/無効、DMCの制御、長さカウンタの状態とAPU割り込みの読み取りに使われる

## $4015への書き込み

---D NT21
D: DMC
N: Noise
T: Triangle
2: Pulse2
1: Pulse1

- これらのビットへの0の書き込みは、そのチャンネルの length counter を停止*させ、ミュートする
- DMC フラグがクリアだと、DMCのバイトの残っているバイトされ、DMCをミュートする
- DMC フラグがセットされていると、DMCサンプルは残っているバイトが0の場合にのみリスタートする。
  1バイトサンプルバッファに残っているビットがあったら、これらは次のサンプルがフェッチされる前に再生を終える
- このレジスタへの書き込みはDMC割り込みフラグをクリアする

*length counter をdisableするということであり halt フラグは関係ない

## $4015の読み取り

IF-D NT21
I: DMC interrupt
F: Frame interrupt
D: DMC active
NT21: Length counter > 0

- NT21は対応する長さカウンターが期限切れもしくは対応するビットへの0の書き込みで停止されていなければ1を返す
- Dは残りのバイトが1以上であれば1を返す
- このレジスタの読み取りは Frame interrupt フラグをクリアする(DMC interrupt フラグはしない)
- 割り込みフラグが読み取りと同時にセットされた場合、1を返すがクリアされない
- このレジスタはCPUに内蔵されており、読み取り時には外部のCPUデータバスは切断される。従って戻り値は外部のはデバイスからは見えず、open bus にも影響を与えない
- Bit 5は Open bus で$4015読み取り時には切断されるので、その値は$4015を読んでいない最後のサイクルから来る

# フレームカウンター ($4017)

MI-- ----
M: Mode
I: IRQ inhibit flag

Modeへの1の書き込みは、フレームカウンターが制御しているすべてのユニットを即座にクロックする
